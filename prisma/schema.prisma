generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// Enums
enum Role {
  ADMIN
  MEMBER
  VIEWER
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
  BACKLOG
  CANCELED
}

model User {
  id        String   @id @default(cuid())
  name      String?
  email     String   @unique
  createdAt DateTime @default(now())

  workspaces WorkspaceMember[]
}

model Workspace {
  id        String   @id @default(cuid())
  name      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  members WorkspaceMember[]
  docs    Doc[]
  tasks   Task[]
  logs    AgentLog[]
  notifications Notification[]

  @@index([name])
}

model WorkspaceMember {
  id          String   @id @default(cuid())
  role        String   @default("MEMBER") // Keeping String for now to avoid migration issues with existing data if any, or mapped to Enum if possible. SQLite doesn't support Enums natively, Prisma handles it. I'll use String for SQLite compatibility safety or just map it. Prisma executes enums in SQLite as strings anyway.
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId      String

  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  workspaceId String

  @@index([userId])
  @@index([workspaceId])
  @@unique([userId, workspaceId])
}

model Doc {
  id          String   @id @default(cuid())
  title       String
  content     String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  workspaceId String

  @@index([workspaceId])
}

model Task {
  id          String   @id @default(cuid())
  title       String
  status      String   @default("todo") 
  assignee    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  workspaceId String

  @@index([workspaceId])
  @@index([status])
}

model AgentLog {
  id          String   @id @default(cuid())
  agent       String
  message     String
  runId       String?   
  createdAt   DateTime @default(now())

  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  workspaceId String

  @@index([workspaceId])
  @@index([runId])    
}

model Notification {
  id          String   @id @default(cuid())
  title       String
  message     String
  type        String   @default("info")
  read        Boolean  @default(false)
  createdAt   DateTime @default(now())

  workspace   Workspace @relation(fields: [workspaceId], references: [id], onDelete: Cascade)
  workspaceId String

  @@index([workspaceId])
  @@index([read])
}